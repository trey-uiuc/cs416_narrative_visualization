<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>

      svg {
        border: 2px solid black;
        background: lightblue;
      }

      path {
        stroke: red;
        stroke-width: 0.25px;
      }

      .country {
        fill: black;
      }

    </style>

  </head>
  <body>
    <h1>This is a Heading</h1>
    <p>This is a paragraph.</p>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script>

      function get_data() {
        let result = d3.csv("./data/wine.csv")
          .then(function(data){
              let grouped_arr = Array.from(d3.rollup(data, v => v.length, d => d.country), ([key, value]) => ({key, value}));
              let grouped_map = d3.rollup(data, v => v.length, d => d.country);
              let filtered_data = grouped_arr.filter((d) => d.value > 10);
              let filtered_map = new Map(
                      filtered_data.map(object => {
                              return [object.key, object.value];
                            }),
                    );
              return filtered_map;
          })
          .catch(function(error){
                  throw error;
          });
        return result;
      }

      <!-- var color = d3.scaleThreshold() -->
            <!-- .domain([1,10]) -->
            <!-- .rangeRound([600, 860]) -->

      var width = 960,
         height = 500;

      var projection = d3.geoMercator()
          .scale(150)

      var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height);

      var path = d3.geoPath()
          .projection(projection);

      var g = svg.append("g")

      // load and display the World
      d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
              .then(function(topology) {
                  let data = get_data()
                        .then(function(wine_data) {
                          console.log(wine_data);
                          g.selectAll("path")
                             .data(topojson.feature(topology, topology.objects.countries).features)
                             .enter().append("path")
                             .attr("class", "country")
                             .attr("text", d => d.properties.name)
                             .attr("d", path);
                        });
                  });

    </script>

  </body>
</html>
